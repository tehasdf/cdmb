tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/4.1/types.yaml
  - plugins/docker2/plugin.yaml
  - plugins/cdmb/plugin.yaml


node_templates:
  localhost:
    type: docker2.Docker

  rabbitmq_network:
    type: docker2.Network
    relationships:
      - type: docker2.container_inside_host
        target: localhost

  rabbitmq_image:
    type: docker2.Image
    properties:
      repository: rabbitmq
      keep: true
    relationships:
      - type: docker2.container_inside_host
        target: localhost

  rabbitmq:
    type: docker2.Container
    properties:
      name: rabbitmq
    relationships:
      - type: docker2.container_inside_host
        target: localhost
      - type: docker2.container_from_image
        target: rabbitmq_image
      - type: docker2.container_connected_to_network
        target: rabbitmq_network

  mgmtworker_config_volume:
    type: cdmb.mgmtworker_config
    relationships:
      - type: docker2.container_inside_host
        target: localhost
      - type: cdmb.config_to_rabbitmq
        target: rabbitmq

  mgmtworker_image:
    type: docker2.Image
    properties:
      dockerfile: components/mgmtworker/image
      image_name: cdmb/mgmtworker
      keep: true
    relationships:
      - type: docker2.container_inside_host
        target: localhost

  mgmtworker:
    type: docker2.Container
    properties:
      name: mgmtworker
    relationships:
      - type: docker2.container_inside_host
        target: localhost
      - type: docker2.container_connected_to_volume
        target: mgmtworker_config_volume
      - type: docker2.container_from_image
        target: mgmtworker_image
      - type: docker2.container_connected_to_network
        target: rabbitmq_network


  # elasticsearch_network:
  #   type: docker2.Network
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost

  # rest_config_volume:
  #   type: cdmb.restservice_config
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost
  #     - type: cdmb.config_to_rabbitmq
  #       target: rabbitmq
  #     - type: cdmb.config_to_elasticsearch
  #       target: elasticsearch

  # rest_image:
  #   type: docker2.Image
  #   properties:
  #     dockerfile: components/restservice/image
  #     image_name: cdmb/restservice
  #     keep: true
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost

  # restservice:
  #   type: docker2.Container
  #   properties:
  #     name: restservice
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost
  #     - type: docker2.container_from_image
  #       target: rest_image
  #     - type: docker2.container_connected_to_network
  #       target: elasticsearch_network
  #     - type: docker2.container_connected_to_volume
  #       target: rest_config_volume

  # es_data_volume:
  #   type: cdmb.es_data
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost

  # es_image:
  #   type: docker2.Image
  #   properties:
  #     repository: elasticsearch
  #     tag: 1
  #     keep: true
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost

  # elasticsearch:
  #   type: docker2.Container
  #   properties:
  #     name: elasticsearch
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost
  #     - type: docker2.container_from_image
  #       target: es_image
  #     - type: docker2.container_connected_to_network
  #       target: elasticsearch_network
  #     - type: docker2.container_connected_to_volume
  #       target: es_data_volume

  # nginx_config_volume:
  #   type: cdmb.nginx_config
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost

  # nginx_image:
  #   type: docker2.Image
  #   properties:
  #     repository: nginx
  #     keep: true
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost

  # nginx:
  #   type: docker2.Container
  #   properties:
  #     name: nginx
  #   relationships:
  #     - type: docker2.container_inside_host
  #       target: localhost
  #     - type: docker2.container_from_image
  #       target: nginx_image
